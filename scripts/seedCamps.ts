// Run with: npx tsx scripts/seedCamps.ts
// Install tsx if needed: npm install -D tsx

import mongoose from 'mongoose';
import { config } from 'dotenv';
import { resolve } from 'path';

// ‡πÇ‡∏´‡∏•‡∏î environment variables
config({ path: resolve(__dirname, '../.env.local') });

// MongoDB Connection
async function connectDB() {
  if (mongoose.connection.readyState >= 1) return;
  
  const MONGODB_URI = process.env.MONGODB_URI;
  if (!MONGODB_URI) {
    throw new Error('MONGODB_URI is not defined');
  }
  
  await mongoose.connect(MONGODB_URI);
}

// Camp Schema
const OrganizerSchema = new mongoose.Schema({
  name: { type: String, required: true },
  imageUrl: { type: String, required: true },
});

const QualificationsSchema = new mongoose.Schema({
  level: { type: String, required: true },
  fields: [{ type: String }],
});

const ReviewSchema = new mongoose.Schema({
  id: { type: String, required: true },
  author: { type: String, required: true },
  rating: { type: Number, required: true, min: 1, max: 5 },
  comment: { type: String, required: true },
  date: { type: String, required: true },
});

const CampSchema = new mongoose.Schema({
  name: { type: String, required: true },
  category: { type: String, required: true },
  date: { type: String, required: true },
  location: { type: String, required: true },
  price: { type: String, required: true },
  image: { type: String, required: true },
  galleryImages: [{ type: String }],
  description: { type: String, required: true },
  deadline: { type: String, required: true },
  participantCount: { type: Number, required: true },
  activityFormat: { type: String, required: true },
  qualifications: { type: QualificationsSchema, required: true },
  additionalInfo: [{ type: String }],
  organizers: [OrganizerSchema],
  reviews: [ReviewSchema],
  avgRating: { type: Number, default: 0 },
  ratingBreakdown: {
    type: Map,
    of: Number,
    default: { '5': 0, '4': 0, '3': 0, '2': 0, '1': 0 }
  },
  featured: { type: Boolean, default: false },
  slug: { type: String, unique: true, required: true },
}, {
  timestamps: true,
});

CampSchema.pre('save', function(next) {
  if (!this.slug) {
    this.slug = this.name
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)/g, '');
  }
  next();
});

interface ReviewType {
  rating: number;
}

CampSchema.pre('save', function(next) {
  if (this.reviews && this.reviews.length > 0) {
    const breakdown: { [key: string]: number } = { '5': 0, '4': 0, '3': 0, '2': 0, '1': 0 };
    let totalRating = 0;

    this.reviews.forEach((review: ReviewType) => {
      totalRating += review.rating;
      breakdown[review.rating.toString()]++;
    });

    this.avgRating = totalRating / this.reviews.length;
    this.ratingBreakdown = new Map(Object.entries(breakdown));
  }
  next();
});

const Camp = mongoose.models.Camp || mongoose.model('Camp', CampSchema);

const sampleCamps = [
  {
    name: "Data Science Bootcamp 2024",
    category: "Data Science",
    date: "15-20 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2025",
    location: "‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ",
    price: "‡∏ü‡∏£‡∏µ",
    image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71",
    galleryImages: [
      "https://images.unsplash.com/photo-1551288049-bebda4e38f71",
      "https://images.unsplash.com/photo-1460925895917-afdab827c52f",
      "https://images.unsplash.com/photo-1504868584819-f8e8b4b6d7e3"
    ],
    description: "‡∏Ñ‡πà‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡∏î‡πâ‡∏≤‡∏ô Data Science ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á",
    deadline: "31 ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2024",
    participantCount: 50,
    activityFormat: "Workshop + Hands-on Project",
    qualifications: {
      level: "‡∏ô‡∏¥‡∏™‡∏¥‡∏ï/‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ 2-4 ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏ô‡πÉ‡∏à‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
      fields: ["‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå"]
    },
    additionalInfo: [
      "‡∏°‡∏µ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£",
      "‡∏°‡∏µ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ï‡∏•‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡∏¢",
      "‡πÅ‡∏à‡∏Å‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å"
    ],
    organizers: [
      {
        name: "KMUTT",
        imageUrl: "https://via.placeholder.com/100"
      }
    ],
    reviews: [
      {
        id: "1",
        author: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
        rating: 5,
        comment: "‡∏Ñ‡πà‡∏≤‡∏¢‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÑ‡∏î‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏™‡∏≠‡∏ô‡∏î‡∏µ",
        date: "2024-12-01"
      }
    ],
    featured: true
  },
  {
    name: "Web Development Workshop",
    category: "Web Development",
    date: "10-12 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2025",
    location: "‡∏à‡∏∏‡∏¨‡∏≤‡∏•‡∏á‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢",
    price: "500 ‡∏ö‡∏≤‡∏ó",
    image: "https://images.unsplash.com/photo-1498050108023-c5249f4df085",
    galleryImages: [
      "https://images.unsplash.com/photo-1498050108023-c5249f4df085",
      "https://images.unsplash.com/photo-1593720213428-28a5b9e94613",
      "https://images.unsplash.com/photo-1461749280684-dccba630e2f6"
    ],
    description: "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏™‡∏°‡∏±‡∏¢‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢ React, Next.js ‡πÅ‡∏•‡∏∞ Tailwind CSS",
    deadline: "31 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2025",
    participantCount: 40,
    activityFormat: "Lecture + Workshop",
    qualifications: {
      level: "‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô HTML, CSS, JavaScript",
      fields: ["‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå"]
    },
    additionalInfo: [
      "‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥ Laptop ‡∏°‡∏≤‡πÄ‡∏≠‡∏á",
      "‡∏°‡∏µ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£",
      "‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏à‡∏ö‡∏Ñ‡πà‡∏≤‡∏¢"
    ],
    organizers: [
      {
        name: "Chula Engineering",
        imageUrl: "https://via.placeholder.com/100"
      }
    ],
    reviews: [],
    featured: true
  },
  {
    name: "AI & Machine Learning Camp",
    category: "AI/ML",
    date: "1-5 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2025",
    location: "‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
    price: "‡∏ü‡∏£‡∏µ",
    image: "https://images.unsplash.com/photo-1555949963-aa79dcee981c",
    galleryImages: [
      "https://images.unsplash.com/photo-1555949963-aa79dcee981c",
      "https://images.unsplash.com/photo-1677442136019-21780ecad995",
      "https://images.unsplash.com/photo-1620712943543-bcc4688e7485"
    ],
    description: "‡∏Ñ‡πà‡∏≤‡∏¢ AI ‡πÅ‡∏•‡∏∞ Machine Learning ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡πâ‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
    deadline: "15 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2025",
    participantCount: 60,
    activityFormat: "Lecture + Project-based Learning",
    qualifications: {
      level: "‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ 2-4 ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô Python",
      fields: ["‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡πÑ‡∏ü‡∏ü‡πâ‡∏≤"]
    },
    additionalInfo: [
      "‡∏°‡∏µ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£",
      "‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏ü‡∏£‡∏µ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)",
      "‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 3 ‡∏°‡∏∑‡πâ‡∏≠"
    ],
    organizers: [
      {
        name: "KU Engineering",
        imageUrl: "https://via.placeholder.com/100"
      }
    ],
    reviews: [
      {
        id: "2",
        author: "‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô",
        rating: 5,
        comment: "‡∏Ñ‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á",
        date: "2024-11-15"
      },
      {
        id: "3",
        author: "‡∏ò‡∏ô‡∏≤ ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ",
        rating: 4,
        comment: "‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡πÑ‡∏õ‡∏ô‡∏¥‡∏î",
        date: "2024-11-20"
      }
    ],
    featured: false
  },
  {
    name: "Mobile App Development",
    category: "Mobile Development",
    date: "20-24 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2025",
    location: "‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
    price: "800 ‡∏ö‡∏≤‡∏ó",
    image: "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c",
    galleryImages: [
      "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c",
      "https://images.unsplash.com/photo-1551650975-87deedd944c3",
      "https://images.unsplash.com/photo-1607252650355-f7fd0460ccdb"
    ],
    description: "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏≠‡∏û‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏î‡πâ‡∏ß‡∏¢ React Native ‡πÅ‡∏•‡∏∞ Flutter",
    deadline: "10 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2025",
    participantCount: 35,
    activityFormat: "Workshop + Team Project",
    qualifications: {
      level: "‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°",
      fields: ["‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", "‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå", "‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®"]
    },
    additionalInfo: [
      "‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥ Laptop ‡∏°‡∏≤‡πÄ‡∏≠‡∏á",
      "‡∏°‡∏µ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£",
      "Workshop ‡πÇ‡∏î‡∏¢‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏£‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥"
    ],
    organizers: [
      {
        name: "TU Engineering",
        imageUrl: "https://via.placeholder.com/100"
      }
    ],
    reviews: [],
    featured: true
  }
];

async function seedDatabase() {
  try {
    console.log('üîå Connecting to MongoDB...');
    await connectDB();
    
    console.log('üóëÔ∏è  Clearing existing camps...');
    await Camp.deleteMany({});
    
    console.log('üå± Seeding camps...');
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á slug ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô insert
    const campsWithSlug = sampleCamps.map(camp => ({
      ...camp,
      slug: camp.name
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/(^-|-$)/g, '')
    }));
    
    const createdCamps = await Camp.insertMany(campsWithSlug);
    
    console.log(`‚úÖ Successfully seeded ${createdCamps.length} camps!`);
    console.log('üìä Created camps:');
    createdCamps.forEach(camp => {
      console.log(`   - ${camp.name} (${camp.slug})`);
    });
    
  } catch (error) {
    console.error('‚ùå Error seeding database:', error);
  } finally {
    await mongoose.connection.close();
    console.log('üëã Database connection closed');
  }
}

seedDatabase();